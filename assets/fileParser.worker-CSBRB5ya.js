(function(){"use strict";const m=(r,t)=>{if(t==="tsv")return"	";if(t==="psv")return"|";if(t==="csv")return",";const c=["	",",",";","|"];let s="	",n=-1;for(const o of c){const e=r.split(o).length-1;e>n&&(n=e,s=o)}return s},y=(r,t)=>{if(!r.includes('"'))return r.split(t);const c=[];let s="",n=!1;for(let o=0;o<r.length;o++){const e=r[o];if(e==='"'){const p=r[o+1];n&&p==='"'?(s+='"',o++):n=!n;continue}if(e===t&&!n){c.push(s),s="";continue}s+=e}return c.push(s),c};self.onmessage=r=>{const{file:t,options:c}=r.data,s=c.extension||"",n=c.chunkSize??1024*1024*10,o=c.batchSize??2e3;let e="",p=0,u=0,a=null,h=!1,l=[];const S=new FileReaderSync,M=()=>{if(l.length>0){const f={type:"rows",rows:l};self.postMessage(f),l=[]}};try{for(let i=0;i<t.size;i+=n){const d=t.slice(i,i+n),v=S.readAsText(d),b=(e+v).split(`
`);e=b.pop()||"";for(const L of b){const g=L.replace(/\r$/,"");if(!g.trim())continue;a||(a=m(g,s));const z=y(g,a);if(!h){const k={type:"header",header:z};self.postMessage(k),h=!0;continue}l.push(z),u+=1,l.length>=o&&M()}p+=d.size;const w={type:"progress",percent:Math.min(p/t.size*100,100),rowsParsed:u};self.postMessage(w)}if(e.trim()){a||(a=m(e,s));const i=y(e.replace(/\r$/,""),a);if(h)l.push(i),u+=1;else{const d={type:"header",header:i};self.postMessage(d),h=!0}}M();const f={type:"done",rowsParsed:u};self.postMessage(f)}catch(f){const i={type:"error",message:f instanceof Error?f.message:"Erro ao processar arquivo"};self.postMessage(i)}}})();
